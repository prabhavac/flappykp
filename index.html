<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flappy KP Game(Mobile)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html, body { margin:0; padding:0; overflow:hidden; height:100%; font-family:'Comic Sans MS', cursive, sans-serif; background:#87CEEB; }
#preGameScreen { position:absolute; width:100%; height:100%; background:#87CEEB; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:20px; box-sizing:border-box; }
#character { display:block; object-fit:contain; max-height:55%; margin-bottom:20px; }
#info { text-align:center; }
#info h1 { margin:0 0 15px 0; font-size:36px; color:black; }
#info p { margin:5px 0; font-size:16px; color:black; }
#info a { color:#0000EE; text-decoration:none; }
#info a:hover { text-decoration:underline; }
#playBtn { padding:12px 25px; font-size:20px; cursor:pointer; background-color:#ff4757; color:white; border:none; border-radius:10px; margin-top:15px; }
#soundToggle { position:absolute; top:10px; right:10px; width:30px; height:30px; cursor:pointer; z-index:10; }
canvas { display:none; background:#87CEEB; position:absolute; top:0; left:0; z-index:1; }
#restartBtn, #homeBtn { position:absolute; left:50%; transform:translateX(-50%); padding:12px 25px; font-size:20px; cursor:pointer; background-color:#ff4757; color:white; border:none; border-radius:10px; display:none; z-index:2; }
#restartBtn { top:75%; }
#homeBtn { top:85%; }
</style>
</head>
<body>

<div id="preGameScreen">
    <img id="character" src="chr.png" alt="Character">
    <img id="soundToggle" src="off.png" alt="Sound Toggle">
    <div id="info">
        <h1>Flappy KP Game</h1>
        <p>Follow me on:</p>
        <p><a href="https://www.instagram.com/prabhavacharya101" target="_blank">Instagram</a></p>
        <p><a href="https://www.facebook.com/chirag.acharya.3705" target="_blank">Facebook</a></p>
        <p>Made by: Prabhav Acharya</p>
        <button id="playBtn">Play</button>
    </div>
</div>

<canvas id="gameCanvas"></canvas>
<button id="restartBtn">Restart</button>
<button id="homeBtn">Home</button>

<audio id="preGameMusic" src="pregame.mp3" loop></audio>
<audio id="bgMusic" src="bgm.mp3" loop></audio>
<audio id="deathMusic" src="dying.mp3" loop></audio>

<script>
const preGameScreen = document.getElementById('preGameScreen');
const playBtn = document.getElementById('playBtn');
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const restartBtn = document.getElementById('restartBtn');
const homeBtn = document.getElementById('homeBtn');
const preGameMusic = document.getElementById('preGameMusic');
const bgMusic = document.getElementById('bgMusic');
const deathMusic = document.getElementById('deathMusic');
const soundToggle = document.getElementById('soundToggle');

let birdImg = new Image(); birdImg.src = 'bird.png';
let deathImg = new Image(); deathImg.src = 'death.jpg';

let bird, pillars, pillarWidth, gap, score, gameOver, clouds;
let lastPillarTime = 0, pillarInterval = 1800;
let soundOn = false;
let lastFrameTime = 0;

// Sound toggle (kept exactly like the working version)
soundToggle.addEventListener('click', () => {
    soundOn = !soundOn;
    soundToggle.src = soundOn ? 'on.png' : 'off.png';
    if (soundOn) {
        if (canvas.style.display === 'none') {
            preGameMusic.play().catch(() => {});
        } else {
            if (gameOver) deathMusic.play().catch(() => {});
            else bgMusic.play().catch(() => {});
        }
    } else {
        preGameMusic.pause();
        bgMusic.pause();
        deathMusic.pause();
    }
});

// Game setup
function initGame() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    bird = { 
        x: canvas.width * 0.25, 
        y: canvas.height * 0.25, 
        width: canvas.width * 0.12, 
        height: canvas.width * 0.12 / 1.2, 
        gravity: 0.48, 
        lift: -11, 
        velocity: 0 
    };

    pillars = [];
    pillarWidth = canvas.width * 0.15;
    gap = canvas.height * 0.35;
    score = 0;
    gameOver = false;
    restartBtn.style.display = 'none';
    homeBtn.style.display = 'none';
    deathMusic.pause();
    deathMusic.currentTime = 0;
    bgMusic.currentTime = 0;

    clouds = [];
    for (let i = 0; i < 6; i++) {
        clouds.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height / 2,
            size: canvas.width * 0.12 * (0.5 + Math.random() * 0.5),
            speed: 0.2 + Math.random() * 0.3
        });
    }

    if (soundOn) bgMusic.play().catch(() => {});
}

function handleInput() { if (!gameOver) bird.velocity = bird.lift; }
document.addEventListener('keydown', handleInput);
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(); });

restartBtn.addEventListener('click', () => {
    deathMusic.pause(); deathMusic.currentTime = 0; initGame(); loop();
});
homeBtn.addEventListener('click', () => {
    deathMusic.pause(); deathMusic.currentTime = 0;
    bgMusic.pause();
    canvas.style.display = 'none';
    preGameScreen.style.display = 'flex';
    restartBtn.style.display = 'none';
    homeBtn.style.display = 'none';
    if (soundOn) preGameMusic.play().catch(() => {});
});
playBtn.addEventListener('click', () => {
    preGameMusic.pause();
    preGameScreen.style.display = 'none';
    canvas.style.display = 'block';
    initGame(); loop();
});
playBtn.addEventListener('touchstart', (e) => {
    e.preventDefault();
    preGameMusic.pause();
    preGameScreen.style.display = 'none';
    canvas.style.display = 'block';
    initGame(); loop();
});

function drawBird() { ctx.drawImage(birdImg, bird.x, bird.y, bird.width, bird.height); }
function drawClouds() {
    ctx.fillStyle = 'white';
    clouds.forEach(c => {
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.size * 0.4, 0, Math.PI * 2);
        ctx.arc(c.x + c.size * 0.3, c.y - c.size * 0.2, c.size * 0.3, 0, Math.PI * 2);
        ctx.arc(c.x + c.size * 0.6, c.y, c.size * 0.35, 0, Math.PI * 2);
        ctx.fill();
        c.x -= c.speed;
        if (c.x + c.size < 0) c.x = canvas.width + c.size;
    });
}
function createPillar() {
    let topHeight = Math.floor(Math.random() * (canvas.height - gap - 80)) + 40;
    let bottomHeight = canvas.height - gap - topHeight;
    pillars.push({ x: canvas.width, top: topHeight, bottom: bottomHeight, passed: false });
}
function updatePillars() {
    let now = Date.now();
    if (now - lastPillarTime > pillarInterval) {
        createPillar();
        lastPillarTime = now;
    }
    for (let i = 0; i < pillars.length; i++) {
        pillars[i].x -= canvas.width * 0.006;
        if (bird.x + bird.width > pillars[i].x && bird.x < pillars[i].x + pillarWidth && 
            (bird.y < pillars[i].top || bird.y + bird.height > canvas.height - pillars[i].bottom)) endGame();
        if (!pillars[i].passed && bird.x > pillars[i].x + pillarWidth) { score++; pillars[i].passed = true; }
    }
    pillars = pillars.filter(p => p.x + pillarWidth > 0);
}
function drawPillars() {
    for (let i = 0; i < pillars.length; i++) {
        let p = pillars[i];
        ctx.fillStyle = '#228B22';
        ctx.fillRect(p.x, 0, pillarWidth, p.top);
        ctx.fillStyle = '#000';
        ctx.fillRect(p.x, canvas.height - p.bottom, pillarWidth, p.bottom);
        let letters = ['G', 'E', 'N', 'Z'], padding = 5;
        let spacingTop = Math.min((p.top - 2 * padding) / letters.length, 30);
        ctx.fillStyle = 'white';
        ctx.font = `${Math.floor(spacingTop)}px Arial Black`;
        ctx.textAlign = 'center';
        for (let j = 0; j < letters.length; j++) ctx.fillText(letters[j], p.x + pillarWidth / 2, padding + spacingTop / 2 + j * spacingTop);
        let spacingBottom = Math.min((p.bottom - 2 * padding) / letters.length, 30);
        ctx.font = `${Math.floor(spacingBottom)}px Arial Black`;
        for (let j = 0; j < letters.length; j++) ctx.fillText(letters[j], p.x + pillarWidth / 2, canvas.height - p.bottom + padding + spacingBottom / 2 + j * spacingBottom);
    }
}
function endGame() {
    if (!gameOver) {
        gameOver = true;
        restartBtn.style.display = 'block';
        homeBtn.style.display = 'block';
        bgMusic.pause();
        if (soundOn) deathMusic.play().catch(() => {});
    }
}
function drawDeathScreen() {
    const imgWidth = canvas.width * 0.4, imgHeight = canvas.width * 0.4;
    ctx.drawImage(deathImg, (canvas.width - imgWidth) / 2, canvas.height * 0.35 - imgHeight / 2, imgWidth, imgHeight);
    ctx.fillStyle = 'black';
    ctx.font = '22px Comic Sans MS';
    ctx.textAlign = 'center';
    ctx.fillStyle = 'red'; ctx.fillText('You died my Nigga Try Again', canvas.width / 2, canvas.height * 0.35 + imgHeight / 2 + 25);
}
function drawScoreAndCredits() {
    ctx.fillStyle = 'black';
    ctx.font = '20px Comic Sans MS';
    ctx.textAlign = 'left';
    ctx.fillText('Score: ' + score, 15, 30);
    ctx.font = '16px Comic Sans MS';
    ctx.fillText('Made By: Prabhav Acharya', 15, canvas.height - 15);
}

function loop(timestamp) {
    if (!lastFrameTime) lastFrameTime = timestamp;
    let delta = timestamp - lastFrameTime;
    lastFrameTime = timestamp;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawClouds();
    if (!gameOver) {
        bird.velocity += bird.gravity;
        bird.y += bird.velocity;
        if (bird.y + bird.height >= canvas.height || bird.y <= 0) endGame();
        drawBird();
        updatePillars();
        drawPillars();
        drawScoreAndCredits();
        requestAnimationFrame(loop);
    } else {
        drawBird();
        drawPillars();
        drawDeathScreen();
        drawScoreAndCredits();
    }
}

window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; initGame(); });
</script>
</body>
</html>
